@page "/Search"
@inject IYoutube youtube
@inject ISecureStorage secureStorage
@inject IDefaultData defaultData
@inject IVideoLibrary videoLibrary
@inject ISettingsLibrary settingsLibrary
@inject ISnackbar snackbar
@inject ISearchHelper searchHelper
@inject IFolderHelper folderHelper
@inject ITokenHelper tokenHelper

<MudText Typo="Typo.h4" Class="text-center text-uppercase mb-4">
    Search
    <MudIcon Icon="@Icons.Custom.Brands.YouTube" Title="Search"></MudIcon>
</MudText>
@if (string.IsNullOrWhiteSpace(errorMessage) is false)
{
    <MudAlert Severity="Severity.Error" Class="mb-4">
        @errorMessage
    </MudAlert>
}

<MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6" Centered="true">
    <MudTabPanel Text="Video">
        <MudGrid Spacing="5">
            <MudItem xs="12" Class="text-center">
                <MudTextField @bind-Value="videoSearchText"
                              Class="mb-4"
                              Label="Input the video's title"
                              HelperText="This is where you input video's title."
                              Variant="Variant.Outlined"
                              Adornment="Adornment.End"
                              AdornmentIcon="@Icons.Material.Filled.Download"
                              OnAdornmentClick="SearchVideos"
                              Required="true"
                              Clearable="true" />
                <MudButtonGroup Class="mt-2">
                    @foreach (var p in downloadPaths)
                    {
                        <MudButton Class="@GetButtonClass(p)"
                                   OnClick="(() => OnButtonClick(p))">
                            @p
                        </MudButton>
                    }
                </MudButtonGroup>
                <MudSelect Label="Video Format:"
                @bind-Value="selectedExtension"
                           Class="mud-input-root text-start"
                           HelperText="Pick your preferred format.">
                    @foreach (var e in videoExtensions)
                    {
                        <MudSelectItem Value="@e" OnClick="SaveStates">@e</MudSelectItem>
                    }
                </MudSelect>
                <MudButton Class="mt-4 w-100"
                           Color="Color.Warning"
                           Variant="Variant.Outlined"
                @onclick="OpenFileLocation">
                    Open Folder Location
                </MudButton>
            </MudItem>
        </MudGrid>
        <MudGrid Spacing="5">
            <MudItem xs="12">
                <MudAutocomplete T="string" Label="@GetVideoSearchBarText()"
                                 Variant="Variant.Outlined"
                                 Class="mb-4"
                                 HelperText="Search the loaded videos."
                                 AdornmentIcon="@Icons.Material.Filled.YoutubeSearchedFor"
                                 OnAdornmentClick="FilterVideos"
                                 SearchFunc="FilterSearchVideos"
                                 ResetValueOnEmptyText="true" />
                @if (videoTokenSource is not null)
                {
                    <MudButton Color="Color.Error"
                               Variant="Variant.Filled"
                               Class="w-100 mb-4"
                    @onclick="CancelVideoSearch">
                        Cancel Video Search
                    </MudButton>
                }
                <MudGrid>
                    <MudVirtualize Items="videoLibrary.VideoResults" Context="v" OverscanCount="10">
                        <VideoComponent @key="v.Id"
                                        Video="new VideoModel(v)"
                                        CardSize="6"
                                        SelectedExtension="@selectedExtension"
                                        SelectedPath="@selectedPath"
                                        RemoveEvent="(() => RemoveVideo(v))" />
                    </MudVirtualize>
                </MudGrid>
            </MudItem>
        </MudGrid>
    </MudTabPanel>
    <MudTabPanel Text="Channel">
        <MudGrid Spacing="5">
            <MudItem xs="12" Class="text-center">
                <MudTextField @bind-Value="channelSearchText"
                              Class="mb-4"
                              Label="Input the channel's title"
                              HelperText="This is where you input the channel's title."
                              Variant="Variant.Outlined"
                              Adornment="Adornment.End"
                              AdornmentIcon="@Icons.Material.Filled.Download"
                              OnAdornmentClick="SearchChannels"
                              Required="true"
                              Clearable="true" />
            </MudItem>
        </MudGrid>
        <MudGrid Spacing="5">
            <MudItem xs="12">
                <MudAutocomplete T="string" Label="@GetChannelSearchBarText()"
                                 Variant="Variant.Outlined"
                                 Class="mb-4"
                                 HelperText="Search the loaded channels"
                                 AdornmentIcon="@Icons.Material.Filled.YoutubeSearchedFor"
                                 OnAdornmentClick="FilterChannels"
                                 SearchFunc="FilterSearchChannels"
                                 ResetValueOnEmptyText="true" />
                @if (channelTokenSource is not null)
                {
                    <MudButton Color="Color.Error"
                               Variant="Variant.Filled"
                               Class="w-100 mb-4"
                    @onclick="CancelChannelSearch">
                        Cancel Channel Search
                    </MudButton>
                }
                <MudGrid>
                    <MudVirtualize Items="videoLibrary.ChannelResults" Context="c" OverscanCount="10">
                        <ChannelComponent @key="c.Id"
                                          Channel="new ChannelModel(c)"
                                          CardSize="6"
                                          SelectedExtension="@selectedExtension"
                                          SelectedPath="@selectedPath"
                                          RemoveEvent="(() => RemoveChannel(c))" />
                    </MudVirtualize>
                </MudGrid>
            </MudItem>
        </MudGrid>
    </MudTabPanel>
    <MudTabPanel Text="Playlist">
        <MudGrid Spacing="5">
            <MudItem xs="12" Class="text-center">
                <MudTextField @bind-Value="playlistSearchText"
                              Class="mb-4"
                              Label="Input the playlist's title"
                              HelperText="This is where you input the playlist's title."
                              Variant="Variant.Outlined"
                              Adornment="Adornment.End"
                              AdornmentIcon="@Icons.Material.Filled.Download"
                              OnAdornmentClick="SearchPlaylists"
                              Required="true"
                              Clearable="true" />
            </MudItem>
        </MudGrid>
        <MudGrid Spacing="5">
            <MudItem xs="12">
                <MudAutocomplete T="string" Label="@GetPlaylistSearchBarText()"
                                 Variant="Variant.Outlined"
                                 Class="mb-4"
                                 HelperText="Search the loaded playlists"
                                 AdornmentIcon="@Icons.Material.Filled.YoutubeSearchedFor"
                                 OnAdornmentClick="FilterPlaylists"
                                 SearchFunc="FilterSearchPlaylists"
                                 ResetValueOnEmptyText="true" />
                @if (playlistTokenSource is not null)
                {
                    <MudButton Color="Color.Error"
                               Variant="Variant.Filled"
                               Class="w-100 mb-4"
                    @onclick="CancelPlaylistSearch">
                        Cancel Playlist Search
                    </MudButton>
                }
                <MudGrid>
                    <MudVirtualize Items="videoLibrary.PlaylistResults" Context="p" OverscanCount="10">
                        <PlaylistComponent @key="p.Id"
                                           Playlist="new PlaylistModel(p)"
                                           CardSize="6"
                                           SelectedExtension="@selectedExtension"
                                           SelectedPath="@selectedPath"
                                           RemoveEvent="(() => RemovePlaylist(p))" />
                    </MudVirtualize>
                </MudGrid>
            </MudItem>
        </MudGrid>
    </MudTabPanel>
</MudTabs>



